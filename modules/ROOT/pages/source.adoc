= Source Configuration

In this chapter we'll discuss how the Source instance is configured.


== Create the Source Instance

You can create a new Source instance with this REST call:

[source,shell]
----
curl -X POST http://localhost:8083/connectors \
  -H 'Content-Type:application/json' \
  -H 'Accept:application/json' \
  -d @source.avro.neo4j.json
----

Let's look at the `source.avro.neo4j.json` file:

[source,json]
----
include::ROOT:example$docker-data/contrib.source.avro.neo4j.json[]
----

This will create a Kafka Connect Source instance that will send `AVRO` message over the topic named `my-topic`.
Every message in the topic will have the following structure:

[source,json]
----
{"name": <name>, "surname": <surname>, "timestamp": <timestamp>}
----


== How the Source module pushes the data to the defined Kafka topic

The source connector pulls change events from Neo4j at the internal specified with `neo4j.cdc.poll-interval`.

Assuming a new node with label `TestSource` is created with a `name` and `timestamp` properties, the following event will be published the configured topic:

[source,json]
----
{"name":{"string":"John Doe"},"timestamp":{"long":1624551349362}}
----

Since the configuration includes `neo4j.enforce.schema=true`, this means a schema is attached to each record, in case
you want to stream pure simple JSON strings just use the relative serializer with `neo4j.enforce.schema=false` with the
following output:

[source,json]
----
{"name": "John Doe", "timestamp": 1624549598834}
----

== Configuration Summary

[#connector-common-configuration]
include::partial$connector-common-configuration.adoc[]


=== Common Source Settings

[%width="100%",cols="m,a",opts=header]
|===
| Name
| Description

| neo4j.source-strategy | image:https://img.shields.io/badge/mandatory-008000[] One of `CDC`, `QUERY`
| neo4j.start-from | image:https://img.shields.io/badge/mandatory-008000[] One of `EARLIEST`, `NOW`, `USER_PROVIDED`
| neo4j.start-from.value | Value to start from. Required by `USER_PROVIDED`
| neo4j.ignore-stored-offset | One of `true`, `false`
| neo4j.batch-size | Batch size (Default: `1000`)

|===

=== `CDC` Strategy Settings

[%width="100%",cols="m,a",opts=header]
|===
| Name
| Description

| neo4j.cdc.poll-interval | image:https://img.shields.io/badge/mandatory-008000[] Interval duration between consecutive CDC polls in seconds, minutes, hours or days. Examples: `1d`, `2h`, `3m`, `4s`, `5ms` (Default: `10s`)
| neo4j.cdc.poll-duration | image:https://img.shields.io/badge/mandatory-008000[] CDC poll duration in seconds, minutes, hours or days. Examples: `1d`, `2h`, `3m`, `4s`, `5ms` (Default: `1s`)
| neo4j.cdc.topic.\{NAME}.patterns | Comma-separated list of graph patterns, with optional event property filters (prefixed with `+` or `-` for inclusion or exclusion respectively).  Example setting: `neo4j.cdc.topic.my-topic.patterns=(:Person {+name}),(:Person)-[:WORKS_FOR]->(:Company),(:Company {-id})`. The change event for `Company` nodes will not include the `id` property.
| neo4j.cdc.topic.\{NAME}.patterns.\{INDEX}.pattern | Indexed graph pattern, with optional event property filters (prefixed with `+` or `-` for inclusion or exclusion respectively). Example: `neo4j.cdc.topic.my-topic.patterns.0.pattern=(:Company {+name})`. The change event for `Company` nodes will either always include the `name` property (in CDC `FULL` enrichment mode) or when the `name` property has changed (in CDC `DIFF` enrichment mode).
| neo4j.cdc.topic.\{NAME}.patterns.\{INDEX}.operation | One of `CREATE`, `UPDATE`, `DELETE`. Operation to perform when receiving events of corresponding indexed graph pattern. Event properties can be explicitly included (`+` prefix`) or excluded (`-`). Example: `neo4j.cdc.topic.my-topic.patterns.0.operation=DELETE`
| neo4j.cdc.topic.\{NAME}.patterns.\{INDEX}.changesTo | Comma-separated list of property selectors. Example: `neo4j.cdc.topic.my-topic.patterns.0.changesTo=name, age` (see link:https://neo4j.com/docs/cdc/current/selectors/#combining-selectors[how selectors are combined])
| neo4j.cdc.topic.\{NAME}.patterns.\{INDEX}.metadata.\{KEY} | Key-value metadata selector. If the key starts `txMetadata.`, then the key-value pair is matched against the actual transaction metadata (with the key stripped of the aforementioned prefix). Example: `neo4j.cdc.topic.my-topic.patterns.0.metadata.txMetadata.app=neo4j-browser`

|===

=== `QUERY` strategy Settings

[%width="100%",cols="m,a",opts=header]
|===
| Name
| Description

| neo4j.topic | image:https://img.shields.io/badge/mandatory-008000[] Topic to write to
| neo4j.query | image:https://img.shields.io/badge/mandatory-008000[] Read query to execute
| neo4j.query.streaming-property | image:https://img.shields.io/badge/mandatory-008000[] Property to watch changes for
| neo4j.enforce-schema | One of `true`, `false`
| neo4j.query.poll-interval | Query poll duration in seconds, minutes, hours or days. Examples: `1d`, `2h`, `3m`, `4s`, `5ms` (Default: `10s`)
| neo4j.query.timeout | Transaction timeout duration in seconds, minutes, hours or days. Examples: `1d`, `2h`, `3m`, `4s`, `5ms` (Default: `0s`)

|===